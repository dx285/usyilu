!function(n){n.extend({progressBar:new function(){this.defaults={steps:20,step_duration:20,max:100,showText:!0,textFormat:"percentage",width:120,height:12,callback:null,boxImage:"images/progressbar.gif",barImage:{0:"images/progressbg_red.gif",30:"images/progressbg_orange.gif",70:"images/progressbg_green.gif"},running_value:0,value:0,image:null},this.construct=function(e,a){var t=null,r=null;return null!=e&&(isNaN(e)?r=e:(t=e,null!=a&&(r=a))),this.each(function(e){function a(n){return 100*n.running_value/n.max}function i(n){var e=n.barImage;if("object"==typeof n.barImage)for(var a in n.barImage){if(!(n.running_value>=parseInt(a)))break;e=n.barImage[a]}return e}function u(n){if(n.showText){if("percentage"==n.textFormat)return" "+Math.round(n.running_value)+"%";if("fraction"==n.textFormat)return" "+n.running_value+"/"+n.max}}var l=this,g=this.config;if(null!=t&&null!=this.bar&&null!=this.config)this.config.value=t,null!=r&&(l.config=n.extend(this.config,r)),g=l.config;else{var s=n(this),g=n.extend({},n.progressBar.defaults,r);g.id=s.attr("id")?s.attr("id"):Math.ceil(1e5*Math.random()),null==t&&(t=s.html().replace("%","")),g.value=t,g.running_value=0,g.image=i(g),s.html("");var c=document.createElement("img"),o=document.createElement("span"),m=n(c),d=n(o);l.bar=m,m.attr("id",g.id+"_pbImage"),d.attr("id",g.id+"_pbText"),d.html(u(g)),m.attr("title",u(g)),m.attr("alt",u(g)),m.attr("src",g.boxImage),m.attr("width",g.width),m.css("width",g.width+"px"),m.css("height",g.height+"px"),m.css("background-image","url("+g.image+")"),m.css("background-position",g.width*-1+"px 50%"),m.css("padding","0"),m.css("margin","0"),s.append(m),s.append(d)}g.increment=Math.round((g.value-g.running_value)/g.steps),g.increment<0&&(g.increment*=-1),g.increment<1&&(g.increment=1);var v=setInterval(function(){var e=g.width/100;g.running_value>g.value?g.running_value-g.increment<g.value?g.running_value=g.value:g.running_value-=g.increment:g.running_value<g.value&&(g.running_value+g.increment>g.value?g.running_value=g.value:g.running_value+=g.increment),g.running_value==g.value&&clearInterval(v);var t=n("#"+g.id+"_pbImage"),r=n("#"+g.id+"_pbText"),s=i(g);s!=g.image&&(t.css("background-image","url("+s+")"),g.image=s),t.css("background-position",g.width*-1+a(g)*e+"px 50%"),t.attr("title",u(g)),r.html(u(g)),null!=g.callback&&"function"==typeof g.callback&&g.callback(g),l.config=g},g.step_duration)})}}}),n.fn.extend({progressBar:n.progressBar.construct})}(jQuery);