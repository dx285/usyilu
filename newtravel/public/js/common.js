var ST={};ST.Util={addTab:function(t,e,s,i){parent.window.addTab(t,e,1,i)},removeTab:function(t){parent.window.removeTab(t);},showMsg:function(t,e,s){s=s?s:1e3,ZENG.msgbox.show(t,e,s)},hideMsgBox:function(){ZENG.msgbox._hide()},showBox:function(t,e,s,i,n,a,o,c){parent.window.floatBox(t,e,s,i,n,a,o,c)},closeBox:function(){parent.window.d.close().remove()},confirmBox:function(t,e,s,i){e='<div class="confirm-box">'+e+"</div>";var n=parent.window.dialog({title:t,content:e,okValue:"确定",ok:function(){s()},cancelValue:"取消",cancel:function(){"function"==typeof i&&i()}});n.showModal()},messagBox:function(t,e,s,i,n){var a=parent.window.dialog({title:t,content:e,width:i,height:n});s?a.show():a.showModal()},helpBox:function(t,e,s){},getDialog:function(){var t=parent.window.document.getElementsByTagName("iframe");for(i=0;i<t.length;i++)if(t[i].contentWindow==window){var e=$(t[i]).parents(".ui-popup:first"),s=e.attr("aria-labelledby");s=s.substr(6);var n=parent.dialog.get(s);return n}return null},closeDialog:function(){var t=this.getDialog();t.remove()},resizeDialog:function(t){var e=this.getDialog(),s=e.maxHeight,i=$(t).height();s&&i>s&&(i=s),e.height(i).show()},resizeDialogHeight:function(t){var e=this.getDialog(),s=e.maxHeight;s&&t>s&&(t=s),e.height(t).show()},responseDialog:function(t,e){var s=this.getDialog();s.finalResponse(t,e)},prevPopup:function(t,e){var s=t?t:window.event;s.stopPropagation?s.stopPropagation():s.cancelBubble=!0},page:function(t,e,s,i,n){var a={hint:'<span class="pageHint">总共<span class="totalPage">{totalPage}</span>页,共<span class="totalCount">{totalCount}</span>条记录</span>'};if(n&&(a=$.extend(a,n)),!s||0==s)return"";i=i?i:6;var o=Math.ceil(s/t),c="<div class='pageContainer'><span class='pagePart'>";if(e<=1)c+='<span class="firstPage short" title="第一页"></span>',c+='<span class="prevPage short" title="上一页"></span>';else{c+='<a href="javascript:;" class="firstPage short" title="第一页" page="1"></a>';var r=parseInt(e)-1;c+='<a  href="javascript:;" class="prevPage short" title="上一页" page="'+r+'"></a>'}var l=Math.floor(i/2),d=i%2==0?l:l,u=i%2==0?l-1:l,p=1,h=o;e>d+1&&o>i&&(p=e-d,h=p+i-1),e>o-u&&o>i&&(h=o,p=o-i+1),e<=d+1&&o>i&&(h=i),p>1&&(c+='<span class="more floor">...</span>');for(var x=p;x<=h;x++)c+=x!=e?'<a href="javascript:;" class="pageable floor" page="'+x+'">'+x+"</a>":'<span class="current floor">'+x+"</span>";if(h<o&&(c+='<span class="more floor">...</span>'),e!=o){var f=parseInt(e)+1;c+='<a href="javascript:;" title="下一页" class="nextPage short" page="'+f+'"></a>',c+='<a href="javascript:;" title="最后一页" class="lastPage short" page="'+o+'"></a>'}else c+='<span class="nextPage short" title="下一页"></span>',c+='<span class="lastPage short" title="最后一页"></span>';c+="</span>";var g=a.hint.replace("{totalPage}",o);return g=g.replace("{totalCount}",s),c+=g,c+="</div>"},insertContent:function(t,e,s){var i=e[0];if(document.selection){this.focus();var n=document.selection.createRange();n.text=t,this.focus(),n.moveStart("character",-o);var a=n.text.length;if(2==arguments.length){var o=i.value.length;n.moveEnd("character",a+s),s<=0?n.moveStart("character",a-2*s-t.length):n.moveStart("character",a-s-t.length),n.select()}}else if(i.selectionStart||"0"==i.selectionStart){var c=i.selectionStart,r=i.selectionEnd,l=i.scrollTop;i.value=i.value.substring(0,c)+t+i.value.substring(r,i.value.length),this.focus(),i.selectionStart=c+t.length,i.selectionEnd=c+t.length,i.scrollTop=l,2==arguments.length&&(i.setSelectionRange(c-s,i.selectionEnd+s),this.focus())}else this.value+=t,this.focus()},goClone:function(t,e){ST.Util.confirmBox("克隆产品",'<div class="add-class"><span class="set-text-xh" style="border: none;padding-right: 5px;">克隆条数:</span><input type="text" id="cloneNum" class="set-text-xh text_100 mt-2 title-color" value="" placeholder="请输入条数"/></div>',function(){var s=$("#cloneNum",window.parent.document).val();s=parseInt(s),s>0&&$.ajax({type:"POST",async:!1,url:SITEURL+e+"/ajax_clone",data:{id:t,num:s},success:function(t){window.product_store.load()}})})}},ST.Destination={setDest:function(t,e,s,i,n,a,o){Ext.getCmp("dest_window_"+s)||Ext.create("Ext.window.Window",{title:"设置目的地",maxWidth:700,maxHeight:500,overflowY:"auto",border:1,style:{borderStyle:"solid",borderWidth:"1px"},id:"dest_window_"+s,minWidth:350,ghost:!1,autoShow:!0,buttons:{style:"background:#fff",items:[{xtype:"button",text:"提交",handler:function(){var t=this,i=Ext.select("#dest_set_"+s+" .dest-set-selected-td input"),c="",r=[];return i.each(function(t,e,s){c+=t.getValue()+",";var i={id:t.getValue(),name:t.getAttribute("rel")};r.push(i)}),c=c.slice(0,-1),a?(t.up("window").close(),Ext.isFunction(n),void n(s,r,0,o)):void Ext.Ajax.request({url:SITEURL+"destination/ajax_setdest",method:"POST",datatype:"JSON",params:{typeid:e,productid:s,kindlist:c},success:function(e,i){var a=e.responseText,o="ok"==a;t.up("window").close(),Ext.isFunction(n),n(s,r,o)}})}},{xtype:"button",text:"取消",handler:function(){this.up("window").close()}}]},html:"<table class='cm-dest-set' id='dest_set_"+s+"' style='table-layout:fixed'><tr class='dest-set-selected-tr'><td width='50' class='td-left'>已选：</td><td class='dest-set-selected-td'></td></tr><tr class='dest-set-search-tr'><td width='50' class='td-left'>搜索：</td><td><input type='text' name='keyword' class='set-text-xh dest-set-keyword'/><button onclick=\"ST.Destination.getNextDestSet(0,0,1,0,'"+s+"')\" class='outbox-ser-btn wid_60 mt-2 ml-5'>搜索</button></td></tr></tr><tr><td valign='top' class='td-left pt-5'>列表：</td><td class='dest-set-list'><div class='dest-set-list-div' style='border-top:0px'><a href='javascript:;' onclick=\"ST.Destination.getNextDestSet(0,0,0,0,'"+s+"')\">全部</a></div></td></tr></table>",listeners:{afterrender:function(){ST.Destination.getNextDestSet(0,0,0,i,s)}}})},getNextDestSet:function(t,e,s,i,n){var a="";0==t&&(a=Ext.select("#dest_set_"+n+" .dest-set-keyword").first().getValue(),a=Ext.String.trim(a)),Ext.Ajax.request({url:SITEURL+"destination/ajax_getDestsetList",method:"POST",datatype:"JSON",params:{pid:e,keyword:a,kindlist:i,status:s},success:function(t,s){var i=Ext.decode(t.responseText),a=0;a=0==e?1:2,i.parents&&(a=i.parents.length+2);for(var o=a;;){var c=Ext.select("#dest_set_"+n+" .dest-set-list-"+o);if(c.getCount()<=0)break;c.remove(),o++}if(i.selected&&Ext.Array.each(i.selected,function(t,e){var s="<label class='mr-20 cor_666 dest-set-one-"+t.id+"' style='float:left;cursor:pointer;white-space:nowrap'><input type='checkbox' checked='checked' class='mr-3' rel='"+t.kindname+"' value='"+t.id+"' onclick='ST.Destination.cancelDest(this,"+t.id+")'/>"+t.kindname+"</label>";Ext.select("#dest_set_"+n+" .dest-set-selected-td").first().insertHtml("beforeEnd",s)}),i.nextlist.length>0){var r=Ext.select("#dest_set_"+n+" .dest-set-selected-td input"),l=[];r.each(function(t,e,s){l.push(t.getValue())});var d="<div class='dest-set-list-div dest-set-list-"+a+"'>";Ext.Array.each(i.nextlist,function(t,e,s){var i=Ext.Array.contains(l,t.id)?"checked='checked'":"";d+="<label class='wid_100 box-hide dest-set-spc-"+t.id+"'><input type='checkbox' "+i+' onclick="ST.Destination.chooseDest(this,'+t.id+",'"+t.kindname+"','"+n+"')\" value='"+t.id+"'/><span step='"+a+"' onclick=\"ST.Destination.getNextDestSet(this,"+t.id+",0,0,'"+n+"')\">"+t.kindname+"(<font color='red'>"+t.childnum+"</font>)</span></label>"}),d+="</div>",Ext.select("#dest_set_"+n+" .dest-set-list").first().insertHtml("beforeEnd",d),Ext.getCmp("dest_window_"+n).hide().show()}}})},chooseDest:function(t,e,s,i){var n=Ext.get(t).is(":checked");if(n){var a=Ext.query("#dest_set_"+i+" .dest-set-one-"+e);if(a.length<=0){var o="<label class='mr-20 cor_666 dest-set-one-"+e+"' style='float:left;cursor:pointer;white-space:nowrap'><input type='checkbox' checked='checked' class='mr-3' rel='"+s+"' value="+e+" onclick='ST.Destination.cancelDest(this,"+e+")'/>"+s+"</label>";Ext.select("#dest_set_"+i+" .dest-set-selected-td").first().insertHtml("beforeEnd",o),Ext.getCmp("dest_window_"+i).hide().show()}}},cancelDest:function(t,e){var s=Ext.get(t).up(".cm-dest-set");Ext.get(t).parent().remove(),s.select(".dest-set-spc-"+e+" input").set({checked:null},!1)}},ST.Attrid={setAttrid:function(t,e,s,i,n,a,o){Ext.getCmp("attr_window_"+s)||Ext.create("Ext.window.Window",{title:"设置属性",maxWidth:600,border:1,style:{borderStyle:"solid",borderWidth:"1px"},id:"attr_window_"+s,minWidth:200,minHeight:100,ghost:!1,autoShow:!0,buttons:{style:"background:#fff",items:[{xtype:"button",text:"提交",handler:function(){var t=this,i=Ext.get("attrid_set_"+s).select("input:checked"),c="",r=[];return i.each(function(t,e,s){c+=t.getValue()+",",r.push({name:t.getAttribute("rel"),id:t.getValue()})}),c=c.slice(0,-1),a?(t.up("window").close(),Ext.isFunction(n),void n(s,r,0,o)):void Ext.Ajax.request({url:SITEURL+"attrid/ajax_setattrid",method:"POST",datatype:"JSON",params:{typeid:e,productid:s,attrids:c},success:function(e,i){var a="ok"==e.responseText;Ext.isFunction(n)&&n(s,r,a),t.up("window").close()}})}},{xtype:"button",text:"取消",handler:function(){this.up("window").close()}}]},listeners:{afterrender:function(t){Ext.Ajax.request({url:SITEURL+"attrid/ajax_attridlist",method:"POST",datatype:"JSON",params:{typeid:e},success:function(e,n){var a=Ext.decode(e.responseText),o=i?i.split(","):[],c="<table class='cm-attrid-set' id='attrid_set_"+s+"'>";Ext.Array.each(a,function(t,e){c+="<tr class='set-attrid-row-p'><td height='40' colspan='2'><span class='ml-10'>"+t.attrname+"</span></td></tr>";var s=Ext.Array.contains(o,t.id)?"checked='checked'":"";t.children&&(c+="<tr class='set-attrid-row-c cld-one-"+t.id+"'><td height='30' valign='top' colspan='2' style='border-bottom:1px solid #eee'>",Ext.Array.each(t.children,function(e,i){var n="";Ext.Array.contains(o,e.id)&&(n="checked='checked'",s="checked='checked'"),c+="<span class='outbox-sx-sp'><label><input type='checkbox' class='mr-3' onclick=\"ST.Attrid.chooseAttr(this,"+e.id+","+t.id+')" '+n+" rel='"+e.attrname+"' value='"+e.id+"'/>"+e.attrname+"<label></span>"}),c+="</td></tr>"),c=c.replace(/\{pchecked\}/gi,s)}),c+="</table>",t.update(c)}})}}})},chooseAttr:function(t,e,s){var i=Ext.get(t).up(".cm-attrid-set");Ext.get(t).is(":checked");if(s)i.select(".set-attrid-one-"+s).set({checked:"checked"},!1);else{var n=i.select(".cld-one-"+e+" input:checked");n.getCount()>0&&(Ext.get(t).set({checked:"checked"},!1),ST.Util.showMsg("下级属性如果被选中的话，主属性也会被选中"))}}},ST.Theme={setTheme:function(t,e,s,i,n){Ext.getCmp("theme_window_"+s)||Ext.create("Ext.window.Window",{title:"设置专题",maxWidth:600,border:1,style:{borderStyle:"solid",borderWidth:"1px"},id:"theme_window_"+s,minWidth:200,minHeight:100,ghost:!1,autoShow:!0,buttons:{style:"background:#fff",items:[{xtype:"button",text:"提交",handler:function(){var t=this,i=Ext.get("theme_set_"+s).select("input:checked"),a="",o=[];i.each(function(t,e,s){a+=t.getValue()+",",o.push({name:t.getAttribute("rel"),id:t.getValue()})}),a=a.slice(0,-1),Ext.Ajax.request({url:SITEURL+"theme/ajax_settheme",method:"POST",datatype:"JSON",params:{typeid:e,productid:s,themes:a},success:function(e,i){var a="ok"==e.responseText;Ext.isFunction(n)&&n(s,o,a),t.up("window").close()}})}},{xtype:"button",text:"取消",handler:function(){this.up("window").close()}}]},listeners:{afterrender:function(t){window.theme_list?ST.Theme.geneList(t,e,s,i,n,window.theme_list):Ext.Ajax.request({url:SITEURL+"theme/ajax_themelist",method:"POST",datatype:"JSON",success:function(a,o){var c=Ext.decode(a.responseText);window.theme_list=c,ST.Theme.geneList(t,e,s,i,n,c)}})}}})},geneList:function(t,e,s,i,n,a){var o="<div class='cm-theme-set' id='theme_set_"+s+"'>",c=i?i.split(","):[];Ext.Array.each(a,function(t,e){var s=Ext.Array.contains(c,t.id)?"checked='checked'":"";o+="<span><input type='checkbox' rel='"+t.ztname+"' value='"+t.id+"' "+s+"/>"+t.ztname+"</span>"}),o+="</div>",t.update(o),t.hide(),t.show()}},ST.Icon={setIcon:function(t,e,s,i,n,a,o){Ext.getCmp("icon_window_ "+s)||Ext.create("Ext.window.Window",{title:"设置图标",maxWidth:600,border:1,style:{borderStyle:"solid",borderWidth:"1px"},id:"icon_window_"+s,minWidth:400,minHeight:300,ghost:!1,autoShow:!0,buttons:{style:"background:#fff",items:[{xtype:"button",text:"提交",handler:function(){var t=this,i=Ext.get("icon_set_"+s).select("input:checked"),c="",r=[];return i.each(function(t,e,s){c+=t.getValue()+",";var i=t.next("img").getAttribute("src");r.push({name:t.getAttribute("rel"),id:t.getValue(),image:i})}),a?(t.up("window").close(),Ext.isFunction(n),void n(s,r,0,o)):(c=c.slice(0,-1),void Ext.Ajax.request({url:SITEURL+"icon/ajax_seticon",method:"POST",datatype:"JSON",params:{typeid:e,productid:s,icons:c},success:function(e,i){var a="ok"==e.responseText;Ext.isFunction(n)&&n(s,r,a),t.up("window").close()}}))}},{xtype:"button",text:"取消",handler:function(){this.up("window").close()}}]},listeners:{afterrender:function(t){window.icon_list?ST.Icon.geneList(t,e,s,i,n,window.icon_list):Ext.Ajax.request({url:SITEURL+"icon/ajax_iconlist",method:"POST",datatype:"JSON",success:function(a,o){var c=Ext.decode(a.responseText);window.icon_list=c,ST.Icon.geneList(t,e,s,i,n,c)}})}}})},geneList:function(t,e,s,i,n,a){var o="<div class='cm-icon-set' id='icon_set_"+s+"'>",c=i?i.split(","):[];Ext.Array.each(a,function(t,e){var s=Ext.Array.contains(c,t.id)?"checked='checked'":"";o+="<span class='fl'><input class='fl' type='checkbox' rel='"+t.kind+"' value='"+t.id+"' "+s+"/><img class='fl' alt='"+t.kind+"' title='"+t.kind+"' src='"+t.picurl+"'/></span>"}),o+="</div>",t.update(o),t.hide(),t.show()}},ST.Modify={getSelectDest:function(t){var e="";return $.each(t,function(t,s){e+="<span><s onclick=\"$(this).parent('span').remove()\"></s>"+s.kindname,e+='<input type="hidden" name="kindlist[]" value="'+s.id+'"></span>'}),e},getSelectAttr:function(t){var e="";return $.each(t,function(t,s){e+="<span><s onclick=\"$(this).parent('span').remove()\"></s>"+s.attrname,e+='<input type="hidden" name="attrlist[]" value="'+s.id+'"></span>'}),e},getSelectIcon:function(t){var e="";return $.each(t,function(t,s){e+='<span><s onclick="$(this).parent(\'span\').remove()"></s><img src="'+s.picurl+'">',e+='<input type="hidden" name="iconlist[]" value="'+s.id+'"></span>'}),e},getUploadFile:function(t,e){var s="",i=0==e?0:1;return $.each(t,function(t,e){var n=t+1;s+='<li class="img-li">',s+='<img class="fl" src="'+e.litpic+'" width="100" height="100">',s+='<p class="p1">',s+='<input type="text" class="img-name" name="imagestitle['+n+']" value="'+e.desc+'" style="width:90px">',s+='<input type="hidden" class="img-path" name="images['+n+']" value="'+e.litpic+'">',s+="</p>",s+='<p class="p2">',i&&(s+='<span class="btn-ste" onclick="Imageup.setHead(this,'+n+')">设为封面</span>'),s+='<span class="btn-closed" onclick="Imageup.delImg(this,\''+e.litpic+"',"+n+')"></span>',s+="</p>",s+="</li>"}),s}},$.fn.focusEffect=function(){var t=this;t.focus(function(){""!=$(this).val()&&$(this).val()!=$(this).attr("datadef")||($(this).val(""),$(this).css({color:"#333"}))}),t.blur(function(){""==$(this).val()&&($(this).val($(this).attr("datadef")),$(this).css({color:"#aaa"}))})},ST.Supplier={setSupplier:function(t,e,s,i,n,a){Ext.getCmp("supplier_window_"+s)||Ext.create("Ext.window.Window",{title:"设置供应商",maxWidth:600,border:1,style:{borderStyle:"solid",borderWidth:"1px"},id:"supplier_window_"+s,minWidth:200,minHeight:100,ghost:!1,autoShow:!0,buttons:{style:"background:#fff",items:[{xtype:"button",text:"提交",handler:function(){var t=this,i=Ext.get("supplier_set_"+s).select("input:checked"),o="",c=[];i.each(function(t,e,s){o+=t.getValue()+",",c.push({name:t.getAttribute("rel"),id:t.getValue()})}),o=o.slice(0,-1),Ext.Ajax.request({url:SITEURL+"supplier/ajax_set_supplier",method:"POST",datatype:"JSON",params:{typeid:e,productid:s,supplierids:o},success:function(e,i){var o="ok"==e.responseText;Ext.isFunction(n)&&n(s,c,o,a),t.up("window").close()}})}},{xtype:"button",text:"取消",handler:function(){this.up("window").close()}}]},listeners:{afterrender:function(t){window.supplier_list?ST.Supplier.geneList(t,e,s,i,n,window.supplier_list):Ext.Ajax.request({url:SITEURL+"supplier/ajax_supplier_list",method:"POST",datatype:"JSON",success:function(a,o){var c=Ext.decode(a.responseText);window.supplier_list=c,ST.Supplier.geneList(t,e,s,i,n,c)}})}}})},geneList:function(t,e,s,i,n,a){var o="<div class='cm-supplier-set' id='supplier_set_"+s+"'>",c=i?i.split(","):[];Ext.Array.each(a,function(t,e){var s=Ext.Array.contains(c,t.id)?"checked='checked'":"";o+="<label class='supplier-sp'><input class='fl mt-3 mr-3' type='radio' name='suppliername' rel='"+t.suppliername+"' value='"+t.id+"' "+s+"/>"+t.suppliername+"</label>"}),o+="</div>",t.update(o),t.hide(),t.show()}};